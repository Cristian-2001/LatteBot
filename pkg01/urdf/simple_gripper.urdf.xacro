<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- Simple Gripper Macro for Pick and Place Operations -->
  <!-- Can be attached to UR10e tool0/flange -->
  
  <xacro:macro name="simple_gripper" params="prefix">
    
    <!-- Materials -->
    <material name="${prefix}gripper_gray">
      <color rgba="0.5 0.5 0.5 1.0"/>
    </material>
    
    <material name="${prefix}gripper_dark">
      <color rgba="0.3 0.3 0.3 1.0"/>
    </material>

    <material name="${prefix}gripper_blue">
      <color rgba="0.2 0.4 0.8 1.0"/>
    </material>

    <!-- Base Link (mounts to robot tool flange) -->
    <link name="${prefix}gripper_base_link">
      <visual>
        <origin xyz="0 0 0.025" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="0.04" length="0.05"/>
        </geometry>
        <material name="${prefix}gripper_gray"/>
      </visual>
      <collision>
        <origin xyz="0 0 0.025" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="0.04" length="0.05"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0.025" rpy="0 0 0"/>
        <mass value="0.3"/>
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0" 
                 iyy="0.0001" iyz="0.0" 
                 izz="0.0001"/>
      </inertial>
    </link>

    <!-- Palm Link (connection point for fingers) -->
    <link name="${prefix}gripper_palm">
      <visual>
        <origin xyz="0 0 0.03" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.08 0.02"/>
        </geometry>
        <material name="${prefix}gripper_blue"/>
      </visual>
      <collision>
        <origin xyz="0 0 0.03" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.08 0.02"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0.03" rpy="0 0 0"/>
        <mass value="0.15"/>
        <inertia ixx="0.00005" ixy="0.0" ixz="0.0" 
                 iyy="0.00005" iyz="0.0" 
                 izz="0.00005"/>
      </inertial>
    </link>

    <!-- Left Finger - Wide blocking design to prevent handle pass-through -->
    <link name="${prefix}left_finger">
      <visual>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.02 0.13"/>
        </geometry>
        <material name="${prefix}gripper_dark"/>
      </visual>
      <collision>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.02 0.13"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <mass value="0.3"/>
        <inertia ixx="0.00018" ixy="0.0" ixz="0.0" 
                 iyy="0.00018" iyz="0.0" 
                 izz="0.00006"/>
      </inertial>
    </link>

    <!-- Right Finger - Wide blocking design to prevent handle pass-through -->
    <link name="${prefix}right_finger">
      <visual>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.02 0.13"/>
        </geometry>
        <material name="${prefix}gripper_dark"/>
      </visual>
      <collision>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <geometry>
          <box size="0.06 0.02 0.13"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0.065" rpy="0 0 0"/>
        <mass value="0.3"/>
        <inertia ixx="0.00018" ixy="0.0" ixz="0.0" 
                 iyy="0.00018" iyz="0.0" 
                 izz="0.00006"/>
      </inertial>
    </link>

    <!-- Left Finger Pad - Blocking surface to prevent pass-through -->
    <link name="${prefix}left_finger_pad">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="0.08 0.005 0.08"/>
        </geometry>
        <material name="${prefix}gripper_dark"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="0.08 0.005 0.08"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="0.00005" ixy="0.0" ixz="0.0" 
                 iyy="0.00005" iyz="0.0" 
                 izz="0.00005"/>
      </inertial>
    </link>

    <!-- Right Finger Pad - Blocking surface to prevent pass-through -->
    <link name="${prefix}right_finger_pad">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="0.08 0.005 0.08"/>
        </geometry>
        <material name="${prefix}gripper_dark"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <box size="0.08 0.005 0.08"/>
        </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="0.05"/>
        <inertia ixx="0.00005" ixy="0.0" ixz="0.0" 
                 iyy="0.00005" iyz="0.0" 
                 izz="0.00005"/>
      </inertial>
    </link>

    <!-- Gripper Tip Link (virtual link for grasping point) -->
    <link name="${prefix}gripper_tip">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
        <material name="${prefix}gripper_blue"/>
      </visual>
    </link>

    <!-- Joint: Base to Palm -->
    <joint name="${prefix}base_to_palm_joint" type="fixed">
      <parent link="${prefix}gripper_base_link"/>
      <child link="${prefix}gripper_palm"/>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
    </joint>

    <!-- Joint: Left Finger (Prismatic - opens/closes) -->
    <!-- Simple parallel jaw gripper with sufficient range to grasp bucket handle -->
    <!-- Starting position: 20mm from center (40mm total separation) -->
    <!-- Closed: -25mm travel = fingers almost touch (can grip thin handles) -->
    <!-- Open: +70mm travel = 180mm grip width (wide opening for approach) -->
    <!-- COMPLIANT DYNAMICS: Lower damping (10.0) prevents force buildup during contact -->
    <joint name="${prefix}left_finger_joint" type="prismatic">
      <parent link="${prefix}gripper_palm"/>
      <child link="${prefix}left_finger"/>
      <origin xyz="0 0.020 0.04" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="-0.025" upper="0.070" effort="500" velocity="0.2"/>
      <dynamics damping="10.0" friction="5.0"/>
    </joint>

    <!-- Joint: Right Finger (Prismatic - opens/closes) -->
    <!-- Mirrors left finger motion to maintain symmetric gripping -->
    <!-- COMPLIANT DYNAMICS: Lower damping (10.0) prevents force buildup during contact -->
    <joint name="${prefix}right_finger_joint" type="prismatic">
      <parent link="${prefix}gripper_palm"/>
      <child link="${prefix}right_finger"/>
      <origin xyz="0 -0.020 0.04" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
      <limit lower="-0.025" upper="0.070" effort="500" velocity="0.2"/>
      <dynamics damping="10.0" friction="5.0"/>
    </joint>

    <!-- Joint: Left Finger to Pad (creates blocking surface) -->
    <joint name="${prefix}left_finger_pad_joint" type="fixed">
      <parent link="${prefix}left_finger"/>
      <child link="${prefix}left_finger_pad"/>
      <origin xyz="0 0.0075 0.09" rpy="0 0 0"/>
    </joint>

    <!-- Joint: Right Finger to Pad (creates blocking surface) -->
    <joint name="${prefix}right_finger_pad_joint" type="fixed">
      <parent link="${prefix}right_finger"/>
      <child link="${prefix}right_finger_pad"/>
      <origin xyz="0 -0.0075 0.09" rpy="0 0 0"/>
    </joint>

    <!-- Joint: Palm to Gripper Tip (fixed, for reference point) -->
    <joint name="${prefix}palm_to_tip_joint" type="fixed">
      <parent link="${prefix}gripper_palm"/>
      <child link="${prefix}gripper_tip"/>
      <origin xyz="0 0 0.13" rpy="0 0 0"/>
    </joint>

    <!-- Gazebo-specific configurations -->
    <gazebo reference="${prefix}gripper_base_link">
      <material>Gazebo/Grey</material>
      <mu1>0.5</mu1>
      <mu2>0.5</mu2>
    </gazebo>

    <gazebo reference="${prefix}gripper_palm">
      <material>Gazebo/Blue</material>
      <mu1>0.8</mu1>
      <mu2>0.8</mu2>
    </gazebo>

    <gazebo reference="${prefix}left_finger">
      <material>Gazebo/DarkGrey</material>
      <mu1>3.0</mu1>
      <mu2>3.0</mu2>
      <kp>50000000.0</kp>
      <kd>5000.0</kd>
      <minDepth>0.00001</minDepth>
      <maxVel>0.001</maxVel>
      <fdir1>0 0 1</fdir1>
      <softCfm>0.0</softCfm>
      <softErp>0.9</softErp>
      <selfCollide>true</selfCollide>
      <gravity>false</gravity>
    </gazebo>

    <gazebo reference="${prefix}right_finger">
      <material>Gazebo/DarkGrey</material>
      <mu1>3.0</mu1>
      <mu2>3.0</mu2>
      <kp>50000000.0</kp>
      <kd>5000.0</kd>
      <minDepth>0.00001</minDepth>
      <maxVel>0.001</maxVel>
      <fdir1>0 0 1</fdir1>
      <softCfm>0.0</softCfm>
      <softErp>0.9</softErp>
      <selfCollide>true</selfCollide>
      <gravity>false</gravity>
    </gazebo>

    <gazebo reference="${prefix}left_finger_pad">
      <material>Gazebo/DarkGrey</material>
      <mu1>3.0</mu1>
      <mu2>3.0</mu2>
      <kp>50000000.0</kp>
      <kd>5000.0</kd>
      <minDepth>0.00001</minDepth>
      <maxVel>0.001</maxVel>
      <fdir1>0 1 0</fdir1>
      <softCfm>0.0</softCfm>
      <softErp>0.9</softErp>
      <selfCollide>true</selfCollide>
      <gravity>false</gravity>
    </gazebo>

    <gazebo reference="${prefix}right_finger_pad">
      <material>Gazebo/DarkGrey</material>
      <mu1>3.0</mu1>
      <mu2>3.0</mu2>
      <kp>50000000.0</kp>
      <kd>5000.0</kd>
      <minDepth>0.00001</minDepth>
      <maxVel>0.001</maxVel>
      <fdir1>0 1 0</fdir1>
      <softCfm>0.0</softCfm>
      <softErp>0.9</softErp>
      <selfCollide>true</selfCollide>
      <gravity>false</gravity>
    </gazebo>

    <!-- Transmission for left finger (for ros_control) -->
    <transmission name="${prefix}left_finger_trans">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${prefix}left_finger_joint">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="${prefix}left_finger_motor">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>

    <!-- Gazebo joint properties for left finger -->
    <gazebo reference="${prefix}left_finger_joint">
      <provideFeedback>true</provideFeedback>
    </gazebo>

    <!-- Transmission for right finger (for ros_control) -->
    <transmission name="${prefix}right_finger_trans">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${prefix}right_finger_joint">
        <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      </joint>
      <actuator name="${prefix}right_finger_motor">
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>

    <!-- Gazebo joint properties for right finger -->
    <gazebo reference="${prefix}right_finger_joint">
      <provideFeedback>true</provideFeedback>
    </gazebo>

  </xacro:macro>

</robot>
